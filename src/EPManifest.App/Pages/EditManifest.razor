@page "/manifests/edit/{id:int}"



@if (_isLoaded == false)
{
    <p><em>Loading...</em></p>
}
else
{
<div>
    <MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-16">
        <MudText Typo="Typo.h3" GutterBottom="true">Edit Manifest #@Id</MudText>
        <EditForm Model="@manifest" OnValidSubmit="Update">
            <DataAnnotationsValidator />
            <MudCard>
                <MudGrid>
                    <MudItem xs="12" md="4">
                        <MudCard>
                            <MudCardContent>
                                <MudText Typo="Typo.h6">Consignor</MudText>
                                <MudSelect T="@EPManifest.Core.Consignor" Label="Consignor(s)" @bind-SelectedValues="@SelectedConsignors" MultiSelection="true" ToStringFunc="c => c.Name">
                                    @foreach (var consignor in Consignors)
                                    {
                                        <MudSelectItem Value="@consignor">@consignor.Name</MudSelectItem>
                                    }
                                </MudSelect>
                                <MudTextField Label="Address Line 1" @bind-Value="@manifest.ConsignorAddress.AddressLine1"
                                              For="@(() => manifest.ConsignorAddress.AddressLine1)">
                                </MudTextField>
                                <MudTextField Label="Address Line 2" @bind-Value="@manifest.ConsignorAddress.AddressLine2"
                                              For="@(() => manifest.ConsignorAddress.AddressLine2)">
                                </MudTextField>
                                <MudTextField Label="City" @bind-Value="@manifest.ConsignorAddress.City"
                                              For="@(() => manifest.ConsignorAddress.City)">
                                </MudTextField>
                                <MudSelect Label="Province/Territory" @bind-Value="@manifest.ConsignorAddress.Province">
                                    @foreach (Core.Provinces province in Enum.GetValues(typeof(Core.Provinces)))
                                        {
                                        <MudSelectItem Value="@province">@province</MudSelectItem>
                                        }
                                </MudSelect>
                                <MudTextField Label="Postal Code" @bind-Value="@manifest.ConsignorAddress.PostalCode"
                                              For="@(() => manifest.ConsignorAddress.PostalCode)">
                                </MudTextField>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                    <MudItem xs="12" md="4">
                        <MudCard>
                            <MudCardContent>
                                <MudText Typo="Typo.h6">Consignee</MudText>
                                <MudSelect T="int" Label="Consignee" @bind-Value="manifest.ConsigneeId">
                                    @foreach (var consignee in Consignees)
                                    {
                                        <MudSelectItem Value="@consignee.Id">@consignee.Name</MudSelectItem>
                                    }
                                </MudSelect>
                                <MudTextField Label="Address Line 1" @bind-Value="@manifest.ConsigneeAddress.AddressLine1"
                                              For="@(() => manifest.ConsigneeAddress.AddressLine1)">
                                </MudTextField>
                                <MudTextField Label="Address Line 2" @bind-Value="@manifest.ConsigneeAddress.AddressLine2"
                                              For="@(() => manifest.ConsigneeAddress.AddressLine2)">
                                </MudTextField>
                                <MudTextField Label="City" @bind-Value="@manifest.ConsigneeAddress.City"
                                              For="@(() => manifest.ConsigneeAddress.City)">
                                </MudTextField>
                                <MudSelect Label="Province/Territory" @bind-Value="@manifest.ConsigneeAddress.Province">
                                    @foreach (Core.Provinces province in Enum.GetValues(typeof(Core.Provinces)))
                                        {
                                        <MudSelectItem Value="@province">@province</MudSelectItem>
                                        }
                                </MudSelect>
                                <MudTextField Label="Postal Code" @bind-Value="@manifest.ConsigneeAddress.PostalCode"
                                              For="@(() => manifest.ConsigneeAddress.PostalCode)">
                                </MudTextField>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>
                    <MudItem xs="12" md="4">
                        <MudCard>
                            <MudCardContent>
                                <MudText Typo="Typo.h6">Carrier</MudText>
                                <MudSelect T="int" Label="Carrier" @bind-Value="manifest.CarrierId">
                                    @foreach (var carrier in Carriers)
                                    {
                                        <MudSelectItem Value="@carrier.Id">@carrier.Name</MudSelectItem>
                                    }
                                </MudSelect>
                            </MudCardContent>
                        </MudCard>
                        <MudCard>
                            <MudCardContent>
                                <MudText Typo="Typo.h6">Dates</MudText>
                                <MudDatePicker Label="Shipped" @bind-Date="manifest.DateShipped" />
                                <MudDatePicker Label="Scheduled Arrival" @bind-Date="manifest.DateScheduledArrival" />
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <MudItem xs="12" md="8">
                        <MudCard>
                            <MudCardContent>
                                <MudText Typo="Typo.h6">Items</MudText>
                                <MudTable Items="@manifest.Items" Dense="true" Hover="true" Striped="true">
                                    <HeaderContent>
                                        <MudTh>#</MudTh>
                                        <MudTh>State</MudTh>
                                        <MudTh>Description</MudTh>
                                        <MudTh>Quantity</MudTh>
                                        <MudTh>Unit</MudTh>
                                        <MudTh></MudTh>
                                    </HeaderContent>
                                    <RowTemplate Context="item">
                                        <MudTd DataLabel="Id">@(manifest.Items.IndexOf(item) + 1)</MudTd>
                                        <MudTd DataLabel="State">@item.State</MudTd>
                                        <MudTd DataLabel="Description">@item.Description</MudTd>
                                        <MudTd DataLabel="Quantity">@item.Quantity</MudTd>
                                        <MudTd DataLabel="Unit">@item.Unit</MudTd>
                                        <MudTd>
                                            <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary"></MudIconButton>
                                            <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error"></MudIconButton>
                                        </MudTd>
                                    </RowTemplate>
                                </MudTable>
                            </MudCardContent>
                        </MudCard>
                    </MudItem>

                    <MudItem xs="12">
                        <MudCardActions>
                            <MudButton ButtonType="ButtonType.Button" Variant="Variant.Filled" Color="Color.Secondary" Link="/manifests">Cancel</MudButton>
                            <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto">Update manifest</MudButton>
                        </MudCardActions>
                    </MudItem>
                </MudGrid>
            </MudCard>
        </EditForm>
    </MudContainer>
</div>
}